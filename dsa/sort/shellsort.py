"""Implementation of the shellsort algorithm."""

from math import ceil, log2

from dsa.sort.insertionsort import insertionsort


def shellsort(xs, gap_seq='cuira'):
    """Sort the list xs using a given gap_seq.

    The gap sequence must be one of the ones in GAPS
    """

    GAPS = {
        'shell': [ len(xs)//(1 << i) for i in range(1, int(ceil(log2(float(len(xs)+1))))) ],

        # Theta(N * log(n)**2) with a smattering of thrashing
        'pratt': [
            3888, 3456, 3072, 2916, 2592, 2304, 2187, 2048, 1944, 1728, 1536, 1458,
            1296, 1152, 1024, 972, 864, 768, 729, 648, 576, 512, 486, 432, 384,
            324, 288, 256, 243, 216, 192, 162, 144, 128, 108, 96, 81, 72, 64,
            54, 48, 36, 32, 27, 24, 18, 16, 12, 9, 8, 6, 4, 3, 2, 1,
        ],

        'incerpi-sedgewick-knuth': [
            70223210512, 30095661648, 13166851971, 5138283696, 2085837936, 852913488,
            343669872, 114556624, 49095696, 21479367, 8382192, 3402672, 1391376,
            463792, 198768, 86961, 33936, 13776, 4592, 1968, 861, 336,
            112, 48, 21, 7, 3, 1,
        ],

        # O(N**(4/3))
        'sedgewick-82': [
            70368756760577, 17592192335873, 4398049656833, 1099513200641,
            274878693377, 68719869953, 17180065793, 4295065601, 1073790977,
            268460033, 67121153, 16783361, 4197377, 1050113, 262913, 65921,
            16577, 4193, 1073, 281, 77, 23, 8, 1,
        ],

        # O(N**(4/3))
        'sedgewick-86': [
            17179475969, 9663381505, 4294770689, 2415771649, 1073643521, 603906049,
            268386305, 150958081, 67084289, 37730305, 16764929, 9427969, 4188161,
            2354689, 1045505, 587521, 260609, 146305, 64769, 36289, 16001, 8929,
            3905, 2161, 929, 505, 209, 109, 41, 19, 5, 1,
        ],

        # Unknown running time
        'tokuda': [
            29414774973, 13073233321, 5810325920, 2582367076, 1147718700, 510097200,
            226709866, 100759940, 44782196, 19903198, 8845866, 3931496, 1747331,
            776591, 345152, 153401, 68178, 30301, 13467, 5985, 2660, 1182,
            525, 233, 103, 46, 20, 9, 4, 1,
        ],

        # Unknown running time, experimentally derived
        'cuira': [1750, 701, 301, 132, 57, 23, 10, 4, 1],
    }

    if gap_seq not in GAPS:
        raise LookupError('Unsupported gap sequence.')

    for gap in GAPS[gap_seq]:
        for i in range(gap, len(xs)):
            j = i
            while j > 0 and xs[j] < xs[j-gap]:
                xs[j], xs[j-gap] = xs[j-gap], xs[j]
                j -= gap
